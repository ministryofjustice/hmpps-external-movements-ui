{% extends "partials/layout.njk" %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "partials/hiddenInputs/macro.njk" import hiddenInputs %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% set fullWidth = true %}
{% set pageTitle = 'Search prisoner - Create a temporary absence' %}

{% block innerContent %}
  <div class="govuk-width-container">
    <div class="govuk-!-static-margin-bottom-6">
      <span class="govuk-caption-l">Create a Temporary Absence</span>
      <h1 class="govuk-heading-l">Search for the prisoner</h1>
    </div>

    <div class="block-background govuk-!-padding-6 govuk-!-margin-bottom-7">
      <div class="moj-search govuk-!-width-two-thirds">
        <form method="GET">
          {{ hiddenInputs(query | getQueryEntries(['history'])) }}
          {{ govukInput({
            name: 'searchTerm',
            classes: "moj-search__input",
            hint: {
              text: "Enter name or prison number. A maximum of 10 results can be returned."
            },
            value: searchTerm
          }) }}

          {{ govukButton({
            classes: "moj-search__button",
            text: "Search",
            preventDoubleClick: true
          }) }}
        </form>
      </div>
    </div>

    {% if not searchTerm %}
      <p class="govuk-!-margin-bottom-6"><strong>Start a search to view prisoner records.</strong></p>
    {% elseif not results.length %}
      <p class="govuk-!-margin-bottom-6"><strong>No prisoner records match your search.</strong></p>
    {% else %}
      {% set rows = [] %}
      {% for prisoner in results %}
        {% set rows = (rows.push([
          {
            text: prisoner | firstNameSpaceLastName
          },
          {
            text: prisoner.prisonerNumber
          },
          {
            text: prisoner.cellLocation
          },
          {
            text: prisoner.currentIncentive.level.description
          },
          {
            classes: 'govuk-link govuk-link--no-visited-state',
            html: '<a class="govuk-link govuk-link--no-visited-state" href="/add-temporary-absence/start/' + prisoner.prisonerNumber + '">Add a Temporary Absence<span class="govuk-visually-hidden"> (' + prisoner.prisonerNumber + ')</span></a>',
            format: "numeric"
          }
        ]), rows) %}
      {% endfor %}

      {{ govukTable({
        firstCellIsHeader: false,
        classes: 'table-vertical-align-middle govuk-!-margin-top-6',
        head: [
          {
            text: "Name"
          },
          {
            text: "Prison Number"
          },
          {
            text: 'Location'
          },
          {
            text: 'Incentive level'
          },
          {
            text: "Action",
            format: "numeric"
          }
        ],
        rows: rows
      }) }}
    {% endif %}
  </div>
{% endblock %}
